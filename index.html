<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#ffffff"/>
<title>Milir | Tonsure & Ear Piercing</title>
<meta name="description" content="Invite for Milir's tonsure and ear piercing at JC Residency, Madurai on 5 Oct 2025, 10:00 am."/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Playfair+Display:wght@600;800&display=swap" rel="stylesheet">
<style>
:root{
  --ink:#222; --muted:#6b6b6b; --bg:#faf7f2; --card:#fff;
  --marigold:#f2a900; --leaf:#2f9e44; --gold:#f4c542; --gold2:#bb9a23;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
img,svg,canvas{max-width:100%;display:block}
.wrap{min-height:100svh;display:grid;place-items:center;padding:16px}
.card{position:relative;background:var(--card);border:1px solid #00000010;border-radius:22px;max-width:560px;width:100%;padding:18px 18px 24px;box-shadow:0 18px 60px rgba(0,0,0,.08);overflow:hidden}

/* Toran */
.toran{position:absolute;left:-6%;right:-6%;top:-2px;height:120px;pointer-events:none}
.string{position:absolute;left:0;right:0;top:22px;height:2px;background:#00000018;border-radius:2px}
.flowers{position:absolute;left:0;right:0;top:0;display:flex;justify-content:space-between;padding:0 22px}
.flower{width:56px;height:80px;display:grid;place-items:flex-start;transform-origin:top center;animation:sway 3.8s ease-in-out infinite}
.bloom{width:44px;height:44px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#ffd76a,var(--marigold));box-shadow:inset 0 8px 14px rgba(0,0,0,.12),0 3px 6px rgba(0,0,0,.12)}
.leaf{width:10px;height:18px;background:var(--leaf);border-radius:10px 10px 2px 10px;margin:2px 0 0 18px;transform:rotate(-14deg)}
.leaf.r{margin-left:0;margin-right:18px;transform:rotate(14deg);justify-self:end}
@keyframes sway{0%,100%{transform:rotate(-4deg)}50%{transform:rotate(4deg)}}

/* Kolam corners */
.corner{position:absolute;width:90px;height:90px;opacity:.25}
.corner.tl{top:6px;left:6px}
.corner.br{bottom:6px;right:6px;transform:scale(-1,-1)}

/* Typography */
.kicker{margin-top:78px;text-align:center;letter-spacing:.14em;text-transform:uppercase;font-size:12px;color:var(--muted)}
.title{font-family:"Playfair Display",serif;font-weight:800;font-size:clamp(36px,7vw,60px);line-height:1.04;text-align:center;margin:6px 0}
.sub{font-size:15px;text-align:center;color:#333}

/* Countdown */
.countdown{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:12px 0 4px}
.tile{min-width:68px;background:#fff;border:1px solid #00000012;border-radius:14px;padding:10px 10px;text-align:center;box-shadow:0 6px 16px rgba(0,0,0,.05)}
.num{font-size:26px;font-weight:800;font-family:"Playfair Display",serif}
.lbl{font-size:11px;color:var(--muted)}

/* Details */
.details{margin:14px auto 10px;display:grid;gap:6px;justify-items:center}
.badge{background:#f6f3ed;border:1px solid #00000010;border-radius:999px;padding:8px 14px;font-size:14px}
.small{font-size:13px;color:var(--muted);text-align:center}

/* Scene container */
.scene{border:1px dashed #00000014;border-radius:14px;background:#fff;padding:12px;margin:12px 0;position:relative;overflow:hidden}
.scene h3{margin:0 0 8px 0;text-align:center;font-weight:800;font-size:16px}

/* Mottai frame */
.mottai .frame{position:relative;width:100%;aspect-ratio:4/5;background:#fff;overflow:hidden;border:1px solid #00000010;border-radius:14px}
.mottai img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center;transition:opacity .12s linear, transform .12s linear}
#withHair{opacity:1;transform:translateY(0)} /* start fully */
#bald{opacity:0}

/* Confetti canvas overlays the frame */
#confetti{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}

/* Actions + QR */
.actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
.btn{appearance:none;border:0;background:#111;color:#fff;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;text-decoration:none}
.btn.ghost{background:#fff;color:#111;border:1px solid #00000020}
.qr{display:grid;place-items:center;margin-top:10px}
.qr img{width:132px;height:132px;border-radius:12px;border:1px solid #00000010}

/* Footer */
.footer{text-align:center;color:var(--muted);font-size:12px;margin-top:12px}

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  .flower{animation:none!important}
}
</style>
</head>
<body>
<div class="wrap">
<main class="card">

  <!-- corners -->
  <svg class="corner tl" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M5 85 Q45 75 55 35 Q65 10 95 5" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"/></svg>
  <svg class="corner br" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M5 85 Q45 75 55 35 Q65 10 95 5" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"/></svg>

  <!-- toran -->
  <div class="toran" aria-hidden="true">
    <div class="string"></div>
    <div class="flowers">
      <div class="flower"><div class="bloom"></div><div class="leaf"></div></div>
      <div class="flower"><div class="bloom"></div><div class="leaf r"></div></div>
      <div class="flower"><div class="bloom"></div><div class="leaf"></div></div>
      <div class="flower"><div class="bloom"></div><div class="leaf r"></div></div>
      <div class="flower"><div class="bloom"></div><div class="leaf"></div></div>
      <div class="flower"><div class="bloom"></div><div class="leaf r"></div></div>
    </div>
  </div>

  <p class="kicker">You are invited</p>
  <h1 class="title">Milir</h1>
  <p class="sub">Tonsure & Ear Piercing ¬∑ JC Residency, Madurai</p>

  <div class="countdown" id="countdown" aria-live="polite"></div>
  <p class="small" style="text-align:center">Sun, 5 Oct 2025 ¬∑ 10:00 am IST</p>

  <section class="details">
    <span class="badge">üìç JC Residency, Madurai</span>
    <span class="badge">üïô 10:00 am</span>
  </section>

  <!-- Mottai scene -->
  <section class="scene mottai" id="mottaiScene" aria-label="Mottai">
    <h3>Mottai Ceremony</h3>
    <div class="frame" id="frameBox">
      <img id="withHair" src="assets/baby_with_hair.png" alt="Baby with hair">
      <img id="bald"     src="assets/bald_baby.png"   alt="Baby after tonsure">
      <canvas id="confetti"></canvas>
    </div>
  </section>

  <div class="feet" aria-hidden="true">
    <svg viewBox="0 0 24 24"><path d="M6 12c-1.8 0-3-.9-3-2.6 0-1.5 1-3.3 2.4-4.1C7.3 4 9 5.5 9 7.4 9 9.7 7.6 12 6 12Z" fill="#d3895b"/><circle cx="4" cy="5" r="1.6" fill="#d3895b"/><circle cx="6.5" cy="4.4" r="1.4" fill="#d3895b"/><circle cx="8.6" cy="5.2" r="1.2" fill="#d3895b"/><circle cx="9.6" cy="6.6" r="1.1" fill="#d3895b"/></svg>
    <svg viewBox="0 0 24 24"><path d="M18 12c1.8 0 3-.9 3-2.6 0-1.5-1-3.3-2.4-4.1C16.7 4 15 5.5 15 7.4c0 2.3 1.4 4.6 3 4.6Z" fill="#d3895b"/><circle cx="20" cy="5" r="1.6" fill="#d3895b"/><circle cx="17.5" cy="4.4" r="1.4" fill="#d3895b"/><circle cx="15.4" cy="5.2" r="1.2" fill="#d3895b"/><circle cx="14.4" cy="6.6" r="1.1" fill="#d3895b"/></svg>
  </div>

  <div class="actions">
    <a class="btn" href="https://www.google.com/maps/search/?api=1&query=JC+Residency+Madurai" target="_blank" rel="noopener">Open map</a>
    <button class="btn ghost" id="addCal">Add to calendar</button>
    <button class="btn" id="shareBtn">Share</button>
  </div>

  <div class="qr">
    <img alt="QR for location" src="https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=https%3A%2F%2Fwww.google.com%2Fmaps%2Fsearch%2F%3Fapi%3D1%26query%3DJC%2BResidency%2BMadurai"/>
    <p class="small">Scan for directions</p>
  </div>

  <p class="footer">With love - family and friends</p>
</main>
</div>

<script>
const EVENT_ISO = "2025-10-05T10:00:00+05:30";

/* countdown */
(function(){
  const el=document.getElementById('countdown');
  const parts=['Days','Hours','Mins','Secs'];
  const tiles=parts.map(l=>{
    const t=document.createElement('div');
    t.className='tile';
    t.innerHTML=`<div class="num">0</div><div class="lbl">${l}</div>`;
    el.appendChild(t); return t;
  });
  function tick(){
    const now=new Date(), target=new Date(EVENT_ISO);
    const s=Math.max(0, Math.floor((target-now)/1000));
    const d=Math.floor(s/86400);
    const h=Math.floor((s%86400)/3600);
    const m=Math.floor((s%3600)/60);
    const sec=s%60;
    [d,h,m,sec].forEach((v,i)=>tiles[i].querySelector('.num').textContent=v);
  }
  setInterval(tick,1000); tick();
})();

/* add to calendar */
(function(){
  const btn=document.getElementById('addCal');
  if(!btn) return;
  btn.addEventListener('click',()=>{
    const title='Milir | Tonsure & Ear Piercing';
    const dtStart=new Date(EVENT_ISO);
    const dtEnd=new Date(dtStart.getTime()+2*60*60*1000);
    const fmt=d=>d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
    const ics=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
DTSTART:${fmt(dtStart)}
DTEND:${fmt(dtEnd)}
SUMMARY:${title}
LOCATION:JC Residency, Madurai
DESCRIPTION:Join us to bless Milir.
END:VEVENT
END:VCALENDAR`;
    const blob=new Blob([ics],{type:'text/calendar'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='milir-ceremony.ics'; a.click();
    URL.revokeObjectURL(url);
  });
})();

/* share */
(function(){
  const btn=document.getElementById('shareBtn');
  if(!btn) return;
  btn.addEventListener('click',async()=>{
    try{
      if(navigator.share){
        await navigator.share({title:document.title,text:'Join us on 5 Oct 2025 at JC Residency, Madurai',url:location.href});
      }else{
        alert('Copy the link: '+location.href);
      }
    }catch{}
  });
})();

/* UTIL */
function fullyVisible(el, margin=6){
  const r = el.getBoundingClientRect();
  const vh = window.innerHeight || document.documentElement.clientHeight;
  return (r.top >= margin) && (r.bottom <= vh - margin);
}

/* Confetti engine */
function confettiBurst(canvas, opts={}){
  const ctx = canvas.getContext('2d');
  const w = canvas.width = canvas.clientWidth;
  const h = canvas.height = canvas.clientHeight;
  const colors = ['#ff8fb1','#ffd166','#95e1d3','#a29bfe','#fca5a5','#fcd34d'];
  const count = opts.count || 120;
  const originX = (opts.x!=null? opts.x : w*0.5);
  const originY = (opts.y!=null? opts.y : h*0.35);
  const gravity = 0.12;
  const drag = 0.008;
  let parts = [];
  for(let i=0;i<count;i++){
    const ang = Math.random()*Math.PI - Math.PI/2; // up left/right
    const speed = 6 + Math.random()*8;
    parts.push({
      x: originX, y: originY,
      vx: Math.cos(ang)*speed,
      vy: Math.sin(ang)*speed - 2,
      w: 4 + Math.random()*3,
      h: 10 + Math.random()*6,
      rot: Math.random()*Math.PI, vr: (Math.random()*2-1)*0.15,
      life: 80 + Math.random()*40,
      color: colors[Math.floor(Math.random()*colors.length)]
    });
  }
  let rafId;
  (function tick(){
    ctx.clearRect(0,0,w,h);
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i];
      p.vy += gravity;
      p.vx *= (1-drag);
      p.vy *= (1-drag*0.6);
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.life -= 1;
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color + Math.floor(180+75*Math.random()).toString(16);
      ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx.restore();
      if(p.life<=0 || p.y>h+40 || p.x<-40 || p.x>w+40) parts.splice(i,1);
    }
    if(parts.length){
      rafId = requestAnimationFrame(tick);
    }else{
      ctx.clearRect(0,0,w,h);
      cancelAnimationFrame(rafId);
    }
  })();
}

/* Mottai interaction:
   - start only when frame fully visible
   - hijack scroll globally while transitioning
   - after complete, require 2 extra scrolls to move on
   - confetti burst on completion
   - reverse on scroll up
*/
(function(){
  const scene    = document.getElementById('mottaiScene');
  const frame    = document.getElementById('frameBox');
  const hairImg  = document.getElementById('withHair');
  const baldImg  = document.getElementById('bald');
  const confetti = document.getElementById('confetti');
  if(!scene||!frame||!hairImg||!baldImg||!confetti) return;

  let progress = 0;              // 0 hair -> 1 bald
  const stepWheel = 0.08;        // per wheel notch
  const stepTouch = 0.003;       // per touch delta
  let completed = false;
  let postHold = 0;              // count of extra scrolls after complete
  const postHoldNeeded = 2;      // "couple of scrolls"

  function render(){
    const p = Math.max(0, Math.min(1, progress));
    hairImg.style.opacity = 1 - p;
    hairImg.style.transform = `translateY(${(-12*p)}px)`;
    baldImg.style.opacity = p;
  }
  render();

  function canStart(){
    // photo must be fully visible to start hijack
    return fullyVisible(scene, 6);
  }

  function shouldHijack(delta){
    if(!canStart()) return false;
    if(completed){
      // after finishing, allow two extra scrolls before releasing
      if(delta>0 && postHold < postHoldNeeded){ return true; }
      if(delta<0 && progress>0){ return true; } // allow reverse immediately
      return false;
    }
    // during transition
    if(delta>0 && progress < 1) return true;
    if(delta<0 && progress > 0) return true;
    return false;
  }

  function onAdvance(amount){
    const prev = progress;
    progress = Math.max(0, Math.min(1, progress + amount));
    render();

    // reached completion
    if(prev < 1 && progress === 1){
      completed = true;
      postHold = 0;
      // fire confetti
      confetti.width = frame.clientWidth;
      confetti.height = frame.clientHeight;
      confettiBurst(confetti, {count: 140});
    }
    // reversed back
    if(prev === 1 && progress < 1){
      completed = false;
    }
  }

  // Wheel - global
  window.addEventListener('wheel', (e)=>{
    const delta = e.deltaY;
    if(shouldHijack(delta)){
      e.preventDefault();
      if(delta>0){
        if(completed){
          postHold++;
          // still hold until quota met, do not move page
        }else{
          onAdvance(stepWheel);
        }
      }else{
        // reverse up
        onAdvance(-stepWheel);
      }
    }
  }, {passive:false});

  // Touch - global
  let touchY=null;
  window.addEventListener('touchstart', (e)=>{
    touchY = e.touches && e.touches.length ? e.touches[0].clientY : null;
  }, {passive:true});

  window.addEventListener('touchmove', (e)=>{
    if(touchY===null) return;
    const y = e.touches[0].clientY;
    const dy = touchY - y; // up = positive
    const delta = dy;
    if(shouldHijack(delta)){
      e.preventDefault();
      if(dy>0){
        if(completed){
          postHold += Math.abs(dy)*0.01; // accumulate touch gestures
        }else{
          onAdvance(stepTouch * dy);
        }
      }else{
        onAdvance(stepTouch * dy); // negative dy reduces progress
      }
    }
    touchY = y;
  }, {passive:false});

  window.addEventListener('touchend', ()=>{ touchY=null; }, {passive:true});

  // Keyboard for accessibility
  window.addEventListener('keydown', (e)=>{
    if(!canStart()) return;
    if(e.key==='ArrowDown' || e.key==='PageDown'){
      if(completed){
        if(postHold < postHoldNeeded){ e.preventDefault(); postHold++; }
      }else if(progress < 1){
        e.preventDefault(); onAdvance(stepWheel);
      }
    }
    if(e.key==='ArrowUp' || e.key==='PageUp'){
      if(progress > 0){ e.preventDefault(); onAdvance(-stepWheel); }
    }
  });

  // Recompute canvas size on resize
  window.addEventListener('resize', ()=>{
    confetti.width = frame.clientWidth;
    confetti.height = frame.clientHeight;
  });
})();

/* Ear-piercing section was removed per your request */

/* helper from earlier */
function fullyVisible(el, margin=6){
  const r = el.getBoundingClientRect();
  const vh = window.innerHeight || document.documentElement.clientHeight;
  return (r.top >= margin) && (r.bottom <= vh - margin);
}
</script>
</body>
</html>
