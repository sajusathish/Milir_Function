<!doctype html>
<html lang="ta">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#ffffff"/>
<title>Milir's | Ear Piercing</title>
<meta name="description" content="Invite for Milir's ear piercing at JC Residency, Madurai on 5 Oct 2025, 10:30 am."/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Playfair+Display:wght@600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#ffffff;
  --maroon:#6A0D25;
  --ink:var(--maroon);
  --muted:var(--maroon);
  --card:#fff;
  --c1:#ff7eb9; --c2:#ffd166; --c3:#90cdf4; --c4:#95e1d3; --c5:#a29bfe;
  --line:#00000018; --light:#f2f2f2; --light2:#e8e8e8; --border:#dddddd;
  --bottom-pad: calc(40px + env(safe-area-inset-bottom, 0px));
  --frame-pad: 10px;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
img,svg,canvas{max-width:100%;display:block}

/* confetti */
#confettiGlobal{position:fixed;inset:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;opacity:0;transition:opacity .25s}

/* layout */
.wrap{min-height:100svh;display:grid;place-items:center;padding:16px;position:relative;z-index:2}
.card{position:relative;background:var(--card);border:1px solid #00000010;border-radius:22px;max-width:560px;width:100%;padding:18px 18px var(--bottom-pad);box-shadow:0 18px 60px rgba(0,0,0,.08);overflow:visible}

/* language toggle */
.lang-toggle{
  position:absolute; right:12px;
  top:clamp(90px,12vw,128px);
  z-index:20; display:flex; align-items:center; gap:6px;
  border:2px solid var(--maroon); border-radius:999px; padding:4px 8px;
  background:rgba(106,13,37,.04); font-size:12px; user-select:none; cursor:pointer;
}
.lang-toggle .chip{padding:3px 8px; border-radius:999px; color:var(--maroon)}
.lang-toggle .chip.active{background:var(--maroon); color:#fff}
.lang-toggle .sep{opacity:.4}

/* corners */
.corner{position:absolute;width:90px;height:90px;opacity:.25}
.corner.tl{top:6px;left:6px}
.corner.br{bottom:6px;right:6px;transform:scale(-1,-1)}

/* party bar */
.partybar{position:absolute;left:-6%;right:-6%;top:0;height:120px;pointer-events:none;animation:breeze 6.5s ease-in-out infinite}
.partybar .string{position:absolute;left:0;right:0;top:24px;height:2px;background:var(--line);border-radius:2px}
.flags{position:absolute;left:0;right:0;top:26px;display:flex;justify-content:space-between;padding:0 20px}
.flag{width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-top:28px solid var(--c1);transform-origin:top center;animation:flagSway 4.2s ease-in-out infinite}
.flag:nth-child(2){border-top-color:var(--c2);animation-delay:.2s}
.flag:nth-child(3){border-top-color:var(--c3);animation-delay:.4s}
.flag:nth-child(4){border-top-color:var(--c4);animation-delay:.1s}
.flag:nth-child(5){border-top-color:var(--c5);animation-delay:.3s}
.flag:nth-child(6){border-top-color:var(--c1);animation-delay:.5s}
.flag:nth-child(7){border-top-color:var(--c2);animation-delay:.25s}
.flag:nth-child(8){border-top-color:var(--c3);animation-delay:.45s}
.flag:nth-child(9){border-top-color:var(--c4);animation-delay:.15s}
.flag:nth-child(10){border-top-color:var(--c5);animation-delay:.35s}
.balloons{position:absolute;left:0;right:0;top:-6px;display:flex;justify-content:space-around;padding:0 30px}
.balloon{width:54px;height:72px;animation:floatBob 5.5s ease-in-out infinite}
.balloon.f2{animation-duration:6.2s;animation-delay:-.6s}
.balloon.f3{animation-duration:5.8s;animation-delay:-.2s}
.balloon .b{filter:drop-shadow(0 6px 10px rgba(0,0,0,.12))}
.balloon .s{stroke:#555;stroke-width:2;fill:none;stroke-linecap:round;opacity:.6}
@keyframes breeze{0%,100%{transform:translateY(0)}50%{transform:translateY(6px)}}
@keyframes flagSway{0%,100%{transform:rotate(-6deg) translateY(0)}50%{transform:rotate(10deg) translateY(15px)}}
@keyframes floatBob{0%,100%{transform:translateY(0) rotate(-1deg)}50%{transform:translateY(25px) rotate(10deg)}}

/* type */
.kicker{
  margin-top:clamp(130px,18vw,180px);
  text-align:center;letter-spacing:.14em;text-transform:uppercase;font-size:12px;color:var(--ink)
}
.title{font-family:"Playfair Display",serif;font-weight:800;font-size:clamp(36px,7vw,60px);line-height:1.04;text-align:center;margin:6px 0;color:var(--ink)}
.sub{font-size:15px;text-align:center;color:var(--ink)}
.sub.addr{margin:2px 0}
.sub.and{margin:4px 0}
.small{font-size:13px;color:var(--ink);text-align:center}

/* keep the second address line on one line */
.addr.nowrap{white-space:nowrap}

/* countdown */
.countdown{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:12px 0 4px}
.tile{min-width:68px;background:#fff;border:1px solid #00000012;border-radius:14px;padding:10px 10px;text-align:center;box-shadow:0 6px 16px rgba(0,0,0,.05)}
.num{font-size:26px;font-weight:800;font-family:"Playfair Display",serif;color:var(--ink)}
.lbl{font-size:11px;color:var(--ink)}

/* details */
.details{margin:14px auto 10px;display:grid;gap:6px;justify-items:center}
.badge{background:#f6f3ed;border:1px solid #00000010;border-radius:999px;padding:8px 14px;font-size:14px;color:var(--ink)}

/* scene */
.scene{border:1px dashed #00000014;border-radius:14px;background:#fff;padding:12px;margin:12px 0;position:relative;overflow:hidden}
.scene h3{margin:0 0 8px;text-align:center;font-weight:400;font-size:16px;color:var(--ink)} /* no bold */

/* frame */
.mottai .frame{
  position:relative; width:100%;
  aspect-ratio:4/5;
  background:#fff; overflow:hidden; border:1px solid #00000010; border-radius:14px;
}
.mottai img{
  position:absolute;
  inset: var(--frame-pad) var(--frame-pad);
  width:calc(100% - var(--frame-pad)*2);
  height:calc(100% - var(--frame-pad)*2);
  object-fit:contain;
  object-position:center;
  transition:opacity .12s linear, transform .12s linear;
}
#withHair{opacity:1;transform:translateY(0)}
#bald{opacity:0}

/* scrollytelling pin section */
.pin{position:relative;height:220svh}
.pin .sticky{position:sticky;top:0;height:90svh;display:grid;align-items:center}

/* invite blurb */
.invite-blurb{margin:12px auto 0; max-width:46ch; text-align:center; font-size:14px; color:var(--ink)}

/* equal-size buttons (anchor and buttons identical) */
.actions{
  display:grid;
  gap:10px;
  grid-template-columns:1fr;
  margin-top:12px
}
@media (min-width:520px){
  .actions{ grid-template-columns:repeat(3,1fr); }
}
.btn, a.btn, button.btn{
  appearance:none; -webkit-appearance:none; border:2px solid var(--maroon);
  border-radius:12px; padding:12px 14px; min-height:44px; width:100%;
  display:inline-flex; align-items:center; justify-content:center; cursor:pointer; text-decoration:none;
  font:700 14px/1.1 Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--maroon); background:#fff;
  transition:transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
}
.btn:hover{ transform:translateY(-1px); background:rgba(106,13,37,.06) }
.btn:active{ transform:none }
.btn:focus-visible{ outline:2px solid var(--maroon); outline-offset:2px }

.qr{display:flex;flex-direction:column;align-items:center;padding-top:20px;padding-bottom:20px;text-align:center}
.qr img{width:240px;height:240px}
.qr .small{margin-top:12px;font-size:14px;color:var(--ink)}

/* footer + buffer */
.footer{text-align:center;color:var(--ink);font-size:12px;margin-top:12px}
.buffer{height:72px}

@media (prefers-reduced-motion: reduce){
  .flag,.balloon,.partybar{animation:none!important}
}
</style>
</head>
<body>

<canvas id="confettiGlobal" aria-hidden="true"></canvas>

<div class="wrap">
<main class="card">

  <!-- Language toggle -->
  <div class="lang-toggle" id="langToggle" role="button" aria-label="Toggle language" tabindex="0">
    <span class="chip active" data-lang="ta">à®¤à®®à®¿à®´à¯</span>
    <span class="sep">|</span>
    <span class="chip" data-lang="en">EN</span>
  </div>

  <svg class="corner tl" viewBox="0 0 100 100"><path d="M5 85 Q45 75 55 35 Q65 10 95 5" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"/></svg>
  <svg class="corner br" viewBox="0 0 100 100"><path d="M5 85 Q45 75 55 35 Q65 10 95 5" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round"/></svg>

  <div class="partybar" aria-hidden="true">
    <div class="string"></div>
    <div class="flags">
      <span class="flag"></span><span class="flag"></span><span class="flag"></span><span class="flag"></span><span class="flag"></span>
      <span class="flag"></span><span class="flag"></span><span class="flag"></span><span class="flag"></span><span class="flag"></span>
    </div>
    <div class="balloons">
      <svg class="balloon f1" viewBox="0 0 80 120" aria-hidden="true">
        <ellipse class="b" cx="40" cy="38" rx="22" ry="28" fill="#ff7eb9"/><path d="M40 66 L36 74 L44 74 Z" fill="#ff7eb9"/><path class="s" d="M40 74 C38 86, 50 96, 40 112"/>
      </svg>
      <svg class="balloon f2" viewBox="0 0 80 120" aria-hidden="true">
        <ellipse class="b" cx="40" cy="38" rx="22" ry="28" fill="#ffd166"/><path d="M40 66 L36 74 L44 74 Z" fill="#ffd166"/><path class="s" d="M40 74 C42 90, 30 98, 40 112"/>
      </svg>
      <svg class="balloon f3" viewBox="0 0 80 120" aria-hidden="true">
        <ellipse class="b" cx="40" cy="38" rx="22" ry="28" fill="#90cdf4"/><path d="M40 66 L36 74 L44 74 Z" fill="#90cdf4"/><path class="s" d="M40 74 C36 86, 48 98, 40 112"/>
      </svg>
    </div>
  </div>

  <!-- Hero text -->
  <p class="kicker" id="kicker">à®‰à®™à¯à®•à®³à¯ˆ à®…à®©à¯à®ªà¯à®Ÿà®©à¯ à®…à®´à¯ˆà®•à¯à®•à®¿à®±à¯‹à®®à¯</p>
  <h1 class="title" id="titleName">à®®à®¿à®²à®¿à®°à®¿à®©à¯</h1>
  <p class="sub and" id="ceremonyLine">à®•à®¾à®¤à¯ à®•à¯à®¤à¯à®¤à¯ à®µà®¿à®´à®¾</p>
  <p class="sub and" id="atLine">à®‡à®Ÿà®®à¯</p>

  <!-- Address -->
  <p class="sub addr" id="addr1" style="font-weight:700">à®œà¯‡.à®šà®¿. à®°à¯†à®šà®¿à®Ÿà¯†à®©à¯à®šà®¿,</p>
  <p class="sub addr nowrap" id="addr2">à®²à¯‡à®Ÿà®¿ à®Ÿà¯‹à®•à¯ à®•à®²à¯à®²à¯‚à®°à®¿ à®šà®¾à®²à¯ˆ, à®šà®¿à®©à¯à®© à®šà¯‹à®•à¯à®•à®¿à®•à¯à®•à¯à®³à®®à¯,</p>
  <p class="sub addr" id="addr3">à®®à®¤à¯à®°à¯ˆ</p>

  <div class="countdown" id="countdown" aria-live="polite"></div>
  <p class="small" id="dateLine" style="text-align:center;font-weight:700">à®à®¾à®¯à®¿à®±à¯, 5 à®…à®•à¯ 2025 Â· à®•à®¾à®²à¯ˆ 10:30 IST</p>

  <section class="details">
    <span class="badge" id="badgeLoc">ğŸ“ à®œà¯‡.à®šà®¿. à®°à¯†à®šà®¿à®Ÿà¯†à®©à¯à®šà®¿, à®®à®¤à¯à®°à¯ˆ</span>
    <span class="badge" id="badgeTime">ğŸ•™ à®•à®¾à®²à¯ˆ 10:30</span>
  </section>

  <!-- Sticky scroll segment -->
  <section class="pin" id="pinWrap">
    <div class="sticky">
      <section class="scene mottai" id="mottaiScene" aria-label="Scene">
        <h3 id="sceneTitle">à®•à®¾à®¤à¯ à®•à¯à®¤à¯à®¤à¯ à®µà®¿à®´à®¾</h3>
        <div class="frame" id="frameBox">
          <img id="withHair" src="./assets/baby_with_hair.png" alt="Baby with hair">
          <img id="bald" src="./assets/bald_baby.png" alt="Baby after tonsure">
        </div>
      </section>
    </div>
  </section>

  <p class="invite-blurb" id="inviteBlurb">à®¤à®¾à®™à¯à®•à®³à¯ à®•à¯à®Ÿà¯à®®à¯à®ªà®¤à¯à®¤à¯à®Ÿà®©à¯ à®µà®°à¯à®•à¯ˆ à®¤à®¨à¯à®¤à¯ à®†à®šà¯€à®°à¯à®µà®¤à®¿à®•à¯à®•à¯à®®à®¾à®±à¯ à®…à®©à¯à®ªà¯à®Ÿà®©à¯ à®•à¯‡à®Ÿà¯à®Ÿà¯à®•à¯à®•à¯Šà®³à¯à®•à®¿à®±à¯‹à®®à¯.</p>

  <!-- Equal-size buttons -->
  <div class="actions">
    <a class="btn" id="btnMap" href="https://www.google.com/maps/search/?api=1&query=JC+Residency+Madurai" target="_blank" rel="noopener">à®µà®°à¯ˆà®ªà®Ÿà®®à¯ à®¤à®¿à®±à®•à¯à®•</a>
    <button class="btn" id="addCal" type="button">à®¨à®¾à®³à¯à®•à®¾à®Ÿà¯à®Ÿà®¿à®¯à®¿à®²à¯ à®šà¯‡à®°à¯à®•à¯à®•</button>
    <button class="btn" id="shareBtn" type="button">à®ªà®•à®¿à®°à¯</button>
  </div>

  <div class="qr">
    <img alt="QR for location" src="https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=https%3A%2F%2Fwww.google.com%2Fmaps%2Fsearch%2F%3Fapi%3D1%26query%3DJC%2BResidency%2BMadurai"/>
    <p class="small" id="qrText">à®µà®´à®¿à®šà¯à®šà¯†à®²à¯à®¤à¯à®¤à®²à¯à®•à¯à®•à®¾à®• à®¸à¯à®•à¯‡à®©à¯ à®šà¯†à®¯à¯à®¯à®µà¯à®®à¯</p>
  </div>

  <p class="footer" id="footerTxt">à®…à®©à¯à®ªà¯à®Ÿà®©à¯, à®•à¯à®Ÿà¯à®®à¯à®ªà®®à¯à®®à¯ à®¨à®£à¯à®ªà®°à¯à®•à®³à¯à®®à¯</p>
  <div class="buffer" aria-hidden="true"></div>
</main>
</div>

<script>
const EVENT_ISO="2025-10-05T10:30:00+05:30";

const STR={
  ta:{
    htmlLang:"ta",
    kicker:"à®‰à®™à¯à®•à®³à¯ˆ à®…à®©à¯à®ªà¯à®Ÿà®©à¯ à®…à®´à¯ˆà®•à¯à®•à®¿à®±à¯‹à®®à¯",
    title:"à®®à®¿à®²à®¿à®°à®¿à®©à¯",
    ceremony:"à®•à®¾à®¤à¯ à®•à¯à®¤à¯à®¤à¯ à®µà®¿à®´à®¾", // removed à®®à¯‹à®Ÿà¯à®Ÿà¯ˆ/à®®à®±à¯à®±à¯à®®à¯
    at:"à®‡à®Ÿà®®à¯",
    addr1:"à®œà¯‡.à®šà®¿. à®°à¯†à®šà®¿à®Ÿà¯†à®©à¯à®šà®¿,",
    addr2:"à®²à¯‡à®Ÿà®¿ à®Ÿà¯‹à®•à¯ à®•à®²à¯à®²à¯‚à®°à®¿ à®šà®¾à®²à¯ˆ, à®šà®¿à®©à¯à®© à®šà¯‹à®•à¯à®•à®¿à®•à¯à®•à¯à®³à®®à¯,", // nowrap via CSS
    addr3:"à®®à®¤à¯à®°à¯ˆ",
    date:"à®à®¾à®¯à®¿à®±à¯, 5 à®…à®•à¯ 2025 Â· à®•à®¾à®²à¯ˆ 10:30 IST",
    badgeLoc:"ğŸ“ à®œà¯‡.à®šà®¿. à®°à¯†à®šà®¿à®Ÿà¯†à®©à¯à®šà®¿, à®®à®¤à¯à®°à¯ˆ",
    badgeTime:"ğŸ•™ à®•à®¾à®²à¯ˆ 10:30",
    scene:"à®•à®¾à®¤à¯ à®•à¯à®¤à¯à®¤à¯ à®µà®¿à®´à®¾",
    blurb:"à®¤à®¾à®™à¯à®•à®³à¯ à®•à¯à®Ÿà¯à®®à¯à®ªà®¤à¯à®¤à¯à®Ÿà®©à¯ à®µà®°à¯à®•à¯ˆ à®¤à®¨à¯à®¤à¯ à®†à®šà¯€à®°à¯à®µà®¤à®¿à®•à¯à®•à¯à®®à®¾à®±à¯ à®…à®©à¯à®ªà¯à®Ÿà®©à¯ à®•à¯‡à®Ÿà¯à®Ÿà¯à®•à¯à®•à¯Šà®³à¯à®•à®¿à®±à¯‹à®®à¯.",
    map:"à®µà®°à¯ˆà®ªà®Ÿà®®à¯ à®¤à®¿à®±à®•à¯à®•",
    cal:"à®¨à®¾à®³à¯à®•à®¾à®Ÿà¯à®Ÿà®¿à®¯à®¿à®²à¯ à®šà¯‡à®°à¯à®•à¯à®•",
    share:"à®ªà®•à®¿à®°à¯",
    qr:"à®µà®´à®¿à®šà¯à®šà¯†à®²à¯à®¤à¯à®¤à®²à¯à®•à¯à®•à®¾à®• à®¸à¯à®•à¯‡à®©à¯ à®šà¯†à®¯à¯à®¯à®µà¯à®®à¯",
    footer:"à®…à®©à¯à®ªà¯à®Ÿà®©à¯, à®•à¯à®Ÿà¯à®®à¯à®ªà®®à¯à®®à¯ à®¨à®£à¯à®ªà®°à¯à®•à®³à¯à®®à¯",
    countdown:["à®¨à®¾à®Ÿà¯à®•à®³à¯","à®®à®£à®¿","à®¨à®¿à®®à®¿à®Ÿà®®à¯","à®µà®¿à®©à®¾à®Ÿà®¿"],
    shareText:"5 à®…à®•à¯ 2025, à®•à®¾à®²à¯ˆ 10:30 Â· JC Residency, Madurai"
  },
  en:{
    htmlLang:"en",
    kicker:"You are invited to",
    title:"Milir's",
    ceremony:"Ear Piercing Ceremony", // removed â€˜Tonsureâ€™
    at:"and", // per your earlier preference
    addr1:"JC Residency,",
    addr2:"Lady Doak College Road, Chinna Chokkikulam,", // keep on one line
    addr3:"Madurai",
    date:"Sun, 5 Oct 2025 Â· 10:30 am IST",
    badgeLoc:"ğŸ“ JC Residency, Madurai",
    badgeTime:"ğŸ•™ 10:30 am",
    scene:"Ear Piercing Ceremony",
    blurb:"Weâ€™d love to have you with us. Your blessings mean a lot to little Milir.",
    map:"Open map",
    cal:"Add to calendar",
    share:"Share",
    qr:"Scan for directions",
    footer:"With love, family and friends",
    countdown:["Days","Hours","Mins","Secs"],
    shareText:"Join us on 5 Oct 2025 at JC Residency, Madurai"
  }
};

let LANG="ta";

/* countdown */
(function(){
  const el=document.getElementById('countdown');
  const parts=STR[LANG].countdown;
  const tiles=parts.map(l=>{
    const t=document.createElement('div');
    t.className='tile';
    t.innerHTML=`<div class="num">0</div><div class="lbl">${l}</div>`;
    el.appendChild(t);
    return t;
  });
  function tick(){
    const now=new Date(), target=new Date(EVENT_ISO);
    const s=Math.max(0,Math.floor((target-now)/1000));
    const d=Math.floor(s/86400), h=Math.floor((s%86400)/3600), m=Math.floor((s%3600)/60), sec=s%60;
    [d,h,m,sec].forEach((v,i)=>tiles[i].querySelector('.num').textContent=v);
  }
  setInterval(tick,1000); tick();
  window._updateCountdownLabels=function(newParts){
    const lbls=el.querySelectorAll('.lbl');
    lbls.forEach((n,i)=>{ if(newParts[i]) n.textContent=newParts[i]; });
  };
})();

/* add to calendar */
(function(){
  const btn=document.getElementById('addCal'); if(!btn) return;
  btn.addEventListener('click',()=>{
    const title="Milir's | Ear Piercing";
    const dtStart=new Date(EVENT_ISO);
    const dtEnd=new Date(dtStart.getTime()+2*60*60*1000);
    const fmt=d=>d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
    const ics=`BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
DTSTART:${fmt(dtStart)}
DTEND:${fmt(dtEnd)}
SUMMARY:${title}
LOCATION:JC Residency, Madurai
DESCRIPTION:Join us to bless Milir.
END:VEVENT
END:VCALENDAR`;
    const blob=new Blob([ics],{type:'text/calendar'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='milir-ceremony.ics'; a.click();
    URL.revokeObjectURL(url);
  });
})();

/* share */
(function(){
  const btn=document.getElementById('shareBtn'); if(!btn) return;
  function doShare(){
    const txt=STR[LANG].shareText;
    try{
      if(navigator.share){
        navigator.share({title:document.title,text:txt,url:location.href});
      }else{
        alert(txt+'\n'+location.href);
      }
    }catch{}
  }
  btn.addEventListener('click',doShare);
})();

/* confetti */
const Confetti=(function(){
  let started=false,canvas,ctx,W,H,parts;
  const colors=['#ff7eb9','#ffd166','#90cdf4','#95e1d3','#a29bfe','#fca5a5','#fcd34d','#c6f6d5'];
  const N=140;
  function size(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight}
  function reset(p,fromTop){p.x=Math.random()*W;p.y=fromTop?(-20-Math.random()*H*0.3):(Math.random()*H);p.w=4+Math.random()*3;p.h=10+Math.random()*6;p.color=colors[Math.floor(Math.random()*colors.length)];p.vx=(Math.random()*2-1)*0.6;p.vy=1.2+Math.random()*1.6;p.rot=Math.random()*Math.PI;p.vr=(Math.random()*2-1)*0.04;p.swing=Math.random()*0.8+0.2;p.life=300+Math.random()*300}
  function loop(){
    if(!started)return;
    ctx.clearRect(0,0,W,H);
    const t=performance.now()*0.001;
    for(let i=0;i<parts.length;i++){
      const p=parts[i]; p.life-=1; p.x+=p.vx+Math.sin(t+i)*p.swing*0.3; p.y+=p.vy; p.rot+=p.vr;
      ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);ctx.fillStyle=p.color;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore();
      if(p.y>H+24||p.x<-40||p.x>W+40||p.life<=0) reset(p,true);
    }
    requestAnimationFrame(loop);
  }
  function start(){
    if(started)return;
    canvas=document.getElementById('confettiGlobal'); if(!canvas)return;
    ctx=canvas.getContext('2d'); size();
    parts=new Array(N).fill(0).map(()=>{const p={};reset(p,false);return p});
    window.addEventListener('resize',size);
    started=true; canvas.style.opacity=1; loop();
  }
  return {start};
})();

/* dynamic frame aspect */
(function(){
  const frame=document.getElementById('frameBox');
  const hair=document.getElementById('withHair');
  const bald=document.getElementById('bald');
  function applyAspectFrom(img){
    if(!img || !frame) return;
    const w=img.naturalWidth, h=img.naturalHeight;
    if(w>0 && h>0){ frame.style.aspectRatio = `${w} / ${h}`; }
  }
  function tryApply(){
    if(hair.naturalWidth && hair.naturalHeight) applyAspectFrom(hair);
    else if(bald.naturalWidth && bald.naturalHeight) applyAspectFrom(bald);
  }
  if(hair.complete) tryApply(); else hair.addEventListener('load', tryApply, {once:true});
  if(bald.complete) tryApply(); else bald.addEventListener('load', tryApply, {once:true});
})();

/* scroll-driven transition */
(function(){
  const pin=document.getElementById('pinWrap');
  const hair=document.getElementById('withHair');
  const bald=document.getElementById('bald');
  if(!pin||!hair||!bald) return;

  let progress=0, fired=false, ticking=false;
  function render(p){
    hair.style.opacity=1-p;
    hair.style.transform=`translateY(${(-12*p)}px)`;
    bald.style.opacity=p;
  }
  function clamp(v,min,max){ return v<min?min:(v>max?max:v); }

  function update(){
    ticking=false;
    const docY=window.scrollY||window.pageYOffset||0;
    const vh=window.innerHeight||document.documentElement.clientHeight;
    const start=pin.offsetTop;
    const total=Math.max(1, pin.offsetHeight - vh);
    const scrolled=clamp(docY - start, 0, total);
    const p=scrolled/total;
    if(p!==progress){
      progress=p;
      render(progress);
      if(!fired && progress>=1){ fired=true; Confetti.start(); }
      if(fired && progress<1){ fired=false; }
    }
  }
  function onScroll(){ if(!ticking){ ticking=true; requestAnimationFrame(update); } }
  update();
  window.addEventListener('scroll', onScroll, {passive:true});
  window.addEventListener('resize', onScroll, {passive:true});
})();

/* language toggle */
(function(){
  const T=STR;
  function apply(lang){
    LANG=lang;
    document.documentElement.lang=T[lang].htmlLang;
    document.getElementById('kicker').textContent=T[lang].kicker;
    document.getElementById('titleName').textContent=T[lang].title;
    document.getElementById('ceremonyLine').textContent=T[lang].ceremony;
    document.getElementById('atLine').textContent=T[lang].at;
    document.getElementById('addr1').textContent=T[lang].addr1;
    document.getElementById('addr2').textContent=T[lang].addr2;
    document.getElementById('addr3').textContent=T[lang].addr3;
    document.getElementById('dateLine').textContent=T[lang].date;
    document.getElementById('badgeLoc').textContent=T[lang].badgeLoc;
    document.getElementById('badgeTime').textContent=T[lang].badgeTime;
    document.getElementById('sceneTitle').textContent=T[lang].scene;
    document.getElementById('inviteBlurb').textContent=T[lang].blurb;
    document.getElementById('btnMap').textContent=T[lang].map;
    document.getElementById('addCal').textContent=T[lang].cal;
    document.getElementById('shareBtn').textContent=T[lang].share;
    document.getElementById('qrText').textContent=T[lang].qr;
    document.getElementById('footerTxt').textContent=T[lang].footer;
    if(window._updateCountdownLabels) window._updateCountdownLabels(T[lang].countdown);
    const chips=document.querySelectorAll('.lang-toggle .chip');
    chips.forEach(c=>c.classList.toggle('active', c.dataset.lang===lang));
  }
  const toggle=document.getElementById('langToggle');
  function flip(){ apply(LANG==='ta'?'en':'ta'); }
  toggle.addEventListener('click', flip);
  toggle.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); flip(); } });
  apply('ta');
})();
</script>
</body>
</html>
